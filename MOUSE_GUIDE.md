# Tmux 鼠标使用指南

> 优化后的鼠标体验配置说明

---

## 当前配置效果

### ✅ 已优化的行为

1. **鼠标拖动选择文本**
   - ✅ 选择后**不会自动跳到底部**
   - ✅ 选择的文本会自动复制
   - ✅ **保持在当前位置**，可以继续浏览

2. **鼠标滚轮**
   - ✅ 向上滚动自动进入复制模式
   - ✅ 向下滚动到底部时自动退出复制模式
   - ✅ 可以平滑浏览历史记录

3. **鼠标点击**
   - ✅ 单击切换窗格
   - ✅ 双击选择单词
   - ✅ 三击选择整行

---

## 查看日志的最佳实践

### 场景 1: 实时跟踪日志（如 tail -f）

```bash
# 启动日志跟踪
tail -f /var/log/app.log

# 方法 A: 滚轮向上查看历史
# 1. 用鼠标向上滚动 → 自动暂停在历史位置
# 2. 用鼠标拖动选择文本 → 复制但不跳转
# 3. 向下滚动到底部 → 自动恢复实时跟踪

# 方法 B: 手动进入复制模式
<prefix> [              # 进入复制模式（暂停输出）
# 浏览、搜索、复制
q                       # 退出复制模式，回到实时输出
```

### 场景 2: 查看大量静态输出

```bash
# 执行命令
ls -lR /var/log

# 方法 A: 鼠标滚轮浏览
# 直接向上滚动查看，选择文本时不会跳转

# 方法 B: 进入复制模式
<prefix> [              # 进入复制模式
g                       # 跳到最顶部
G                       # 跳到最底部
/error                  # 搜索 "error"
n                       # 下一个匹配
```

### 场景 3: 需要频繁复制的情况

```bash
# 进入复制模式
<prefix> [

# 复制方式 1: 鼠标拖动（推荐）
# 直接拖动选择 → 自动复制到剪贴板
# 可以继续选择其他内容

# 复制方式 2: 键盘
v                       # 开始选择
hjkl 或方向键            # 移动扩展选择
y                       # 复制

# 复制方式 3: 快速选择
# 双击单词 → 选择整个单词
# 三击行 → 选择整行
```

---

## 鼠标操作速查表

| 操作 | 效果 | 说明 |
|------|------|------|
| **滚轮向上** | 向上浏览历史 | 自动进入复制模式 |
| **滚轮向下** | 向下浏览 | 到底部时自动退出复制模式 |
| **拖动选择** | 选择并复制文本 | **不会跳到底部** ✨ |
| **单击窗格** | 激活窗格 | 切换当前窗格焦点 |
| **双击** | 选择单词 | 自动选择光标下的单词 |
| **三击** | 选择整行 | 自动选择整行内容 |
| **点击窗口** | 切换窗口 | 点击状态栏的窗口名称 |
| **拖动边界** | 调整窗格大小 | 拖动窗格之间的分割线 |

---

## 键盘 + 鼠标组合技巧

### 技巧 1: 快速定位并复制

```bash
# 1. 鼠标滚轮向上浏览
# 2. 看到目标内容后，直接鼠标拖动选择
# 3. 自动复制，位置不变
# 4. 可以继续选择其他内容
```

### 技巧 2: 搜索 + 鼠标选择

```bash
# 1. 进入复制模式
<prefix> [

# 2. 搜索定位
/关键词

# 3. 用鼠标选择搜索结果附近的文本
# 4. 继续按 n 查看下一个匹配
```

### 技巧 3: 查看长日志文件

```bash
# 方法 1: 结合 less
tail -1000 app.log | less
# 在 less 中可以用鼠标滚动

# 方法 2: 在 tmux 中直接查看
tail -1000 app.log
<prefix> [              # 进入复制模式
g                       # 跳到开头
# 然后用鼠标滚轮或拖动选择
```

---

## 特殊场景处理

### 场景: 复制跨多屏的内容

```bash
# 1. 进入复制模式
<prefix> [

# 2. 移动到起始位置
gg                      # 或用鼠标滚到开始位置

# 3. 开始选择
v                       # 开始 visual 模式

# 4. 移动到结束位置
G                       # 跳到最后
# 或
/结束标记                # 搜索定位

# 5. 复制
y

# 6. 粘贴
<prefix> p
```

### 场景: 在分屏中查看和比较日志

```bash
# 创建水平分屏
<prefix> -

# 上方窗格: 错误日志
tail -f error.log

# 下方窗格: 访问日志
tail -f access.log

# 在任意窗格中:
# - 鼠标点击切换窗格
# - 滚轮向上查看历史
# - 拖动选择复制内容
```

### 场景: 导出选中的日志

```bash
# 1. 用鼠标或键盘选择需要的内容并复制

# 2. 在新窗格或新窗口中
<prefix> p > /tmp/selected.log    # 粘贴并保存

# 或者直接捕获整个窗格
<prefix> :
capture-pane -S -1000 -p > /tmp/last-1000-lines.log
```

---

## 故障排查

### 问题 1: 鼠标选择后还是跳到底部

**可能原因**: 配置未生效

**解决方法**:
```bash
# 重新加载配置
<prefix> r

# 或退出重启 tmux
tmux kill-server
tmux
```

### 问题 2: 鼠标滚轮不工作

**检查**:
```bash
# 查看鼠标模式状态
tmux show-options -g mouse

# 应该显示: mouse on
```

**解决**:
```bash
# 如果是 off，启用它
<prefix> m
```

### 问题 3: 选择的文本没有复制到系统剪贴板

**原因**: 剪贴板集成未启用

**解决**:
```bash
# 编辑配置
vim ~/.tmux.conf.local

# 找到并修改:
tmux_conf_copy_to_os_clipboard=true

# 重新加载
<prefix> r
```

### 问题 4: 想恢复原来的行为（选择后跳到底部）

**解决**: 注释掉鼠标行为配置
```bash
vim ~/.tmux.conf.local

# 找到 "mouse behavior improvements" 部分
# 注释掉这些行（在行首添加 #）

# 重新加载
<prefix> r
```

---

## 配置说明

当前在 `~/.tmux.conf.local` 中添加的配置:

```bash
# -- mouse behavior improvements -----------------------------------------------

# 鼠标拖动结束时不自动复制和退出复制模式（保持在当前位置）
unbind -T copy-mode-vi MouseDragEnd1Pane #!important
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-no-clear #!important

# 双击选择单词
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word #!important

# 三击选择整行
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line #!important
```

**关键改进**:
- `MouseDragEnd1Pane` → `copy-selection-no-clear`: 复制但不清除选择，不退出复制模式
- 添加双击和三击的便捷选择

---

## 最佳实践建议

### ✅ 推荐的工作流

1. **日常开发**: 鼠标 + 键盘混用
   - 用鼠标快速定位和复制
   - 用键盘精确搜索和导航

2. **查看日志**: 先进复制模式
   - `<prefix> [` 进入复制模式
   - 鼠标滚动和选择
   - `q` 退出回到实时输出

3. **长时间监控**: 分屏 + 鼠标
   - 一个窗格实时跟踪
   - 另一个窗格分析历史
   - 鼠标在窗格间切换

### ❌ 避免的做法

1. ❌ 不要在实时输出时直接拖选文本（容易错位）
   - ✅ 应该先进入复制模式或向上滚动

2. ❌ 不要长时间停留在复制模式看实时日志
   - ✅ 应该退出复制模式让输出继续

3. ❌ 不要禁用鼠标模式
   - ✅ 合理使用鼠标能大幅提升效率

---

## 进阶技巧

### 技巧 1: 自定义鼠标右键行为

```bash
# 在 .tmux.conf.local 添加
# 右键点击粘贴
bind -T copy-mode-vi MouseDown3Pane send -X cancel \; paste-buffer #!important
```

### 技巧 2: 中键粘贴

```bash
# 中键点击粘贴（X11 primary selection）
bind -n MouseDown2Pane paste-buffer #!important
```

### 技巧 3: 滚轮速度调整

```bash
# 如果觉得滚轮太快或太慢，可以调整
# 这个需要在终端模拟器中设置，tmux 无法直接控制
```

---

## 对比: 优化前 vs 优化后

| 操作 | 优化前 | 优化后 |
|------|--------|--------|
| 鼠标选择文本 | ❌ 选择后跳到底部 | ✅ 保持在当前位置 |
| 继续选择 | ❌ 需要重新滚动上去 | ✅ 可以直接继续选择 |
| 查看日志 | ❌ 容易丢失查看位置 | ✅ 位置稳定不跳动 |
| 复制多段内容 | ❌ 困难，每次都跳 | ✅ 容易，位置不变 |
| 滚轮浏览 | ✅ 正常工作 | ✅ 正常工作 |

---

## 快速参考卡片

### 查看日志三步法

1. **进入查看模式**
   ```
   <prefix> [        或者直接滚轮向上
   ```

2. **浏览和复制**
   ```
   鼠标滚轮        → 上下浏览
   鼠标拖动        → 选择复制（不跳转）
   /关键词         → 搜索
   ```

3. **退出继续**
   ```
   q               → 退出复制模式
   滚到底部        → 自动退出
   ```

### 紧急禁用鼠标

```bash
# 如果鼠标影响了某些操作（如 vim 内部）
<prefix> m          # 临时禁用鼠标
# 操作完成后
<prefix> m          # 重新启用
```

---

**提示**: 这些优化让鼠标使用更符合直觉，特别是在查看长日志时！

生成时间: 2026-02-02
配置位置: ~/.tmux.conf.local (mouse behavior improvements 部分)
